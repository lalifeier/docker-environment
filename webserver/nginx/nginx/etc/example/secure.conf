server {
  listen 80;
  server_name localhost;

  location / {
    # refer模块防盗
    valid_referers none blocked server_names
                    *.example.com example.* www.example.org/galleries/
                    ~\.google\.;
    if ($invalid_referer) {
      return 403;
    }

    # secure_link模块防盗
    # ./configure --with-http_secure_link_module
    secure_link $arg_md5,$arg_expires;
    secure_link_md5 "$secure_link_expires$uri$remote_addr secret";

    if ($secure_link = "") {
      return 403;
    }

    if ($secure_link = "0") {
      return 410;
    }

    return 200 '$secure_link:$secure_link_expires\n';
  }

  error_page 500 502 503 504 /50x.html;
  location = /50x.html {
    root html;
  }
}
